<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Absensi Angkringan Modern</title>
<style>
:root{
  --bg:#f0f0f5;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted: rgba(28,28,30,0.6);

  /* Warna utama jadi gradasi coklat */
  --accent-primary: linear-gradient(135deg, #8B4513, #D2691E);
  --accent-secondary: #D2B48C; 
  --accent-red: #ff4d4d;
  --accent-green: #4CAF50;
  --accent-orange: #FFC107;

  --soft-shadow: 0 4px 12px rgba(16,24,40,0.06);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}
body {
  font-family: var(--font-family);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  min-height: 100vh;
  background-size: cover;
  background-attachment: fixed;
}
.app {
  width: 100%;
  max-width: 420px;
  padding: 20px;
  padding-bottom: 70px;
}
.banner {
  background: linear-gradient(135deg, #8B4513, #D2691E);
  color: white;
  border-radius: 14px;
  padding: 28px 18px;
  text-align: center;
  margin-bottom: 18px;
  box-shadow: var(--soft-shadow);
}
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 18px;
}
.card-action {
  background: var(--card);
  border-radius: 14px;
  padding: 16px 12px;
  cursor: pointer;
  text-align:center;
  font-weight: 600;
  font-size: 14px; 
  box-shadow: var(--soft-shadow);
  transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
}
.card-action:active {
  transform: scale(0.95);
  box-shadow: 0 0 15px rgba(139,69,19,0.6);
}
.grid-three {
    grid-template-columns: 1fr 1fr 1fr;
    margin-bottom: 18px;
}
.section-title { 
  font-weight:700; 
  margin: 8px 4px 12px; 
  font-size:18px; 
  cursor: pointer;
  color: #8B4513;
}
.riwayat-item {
  background: var(--card);
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 10px;
  display:flex;
  flex-direction: column;
  box-shadow: var(--soft-shadow);
  border-left: 5px solid transparent;
}
.riwayat-item.absen { border-left-color: var(--accent-green); }
.riwayat-item.gantikan { border-left-color: var(--accent-orange); }

#overlay {
  display:none;
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(255,255,255,0.98);
  padding:20px;
  overflow-y:auto;
  z-index:1000;
}
.list-item {
  background:var(--card);
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
  cursor:pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  font-weight: 500;
  border-left: 5px solid #8B4513;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.batal-btn-overlay{
  background:var(--accent-red);
  color:white;
  text-align:center;
  padding:12px;
  border-radius:10px;
  cursor:pointer;
  margin-top: 20px;
  font-weight: 600;
}
#toast {
    visibility: hidden;
    min-width: 250px;
    margin-left: -125px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 16px;
    position: fixed;
    z-index: 2000;
    left: 50%;
    bottom: 30px;
    font-size: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}
#toast.show {
    visibility: visible;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
}
@keyframes fadein { from { bottom: 0; opacity: 0; } to { bottom: 30px; opacity: 1; } }
@keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 0; opacity: 0; } }
</style>
</head>
<body>
<div class="app">
  <div class="banner">
    <h1>ABSENSI ANGKRINGAN</h1>
    <div id="status-ringkas" style="font-size:14px; margin-top:10px; font-weight:bold; background: rgba(0,0,0,0.2); padding: 6px; border-radius: 6px;">
        Memuat status hari ini...
    </div>
  </div>
  
  <div class="grid grid-three">
    <div class="card-action" onclick="mulaiAbsen()">üëã Absen Sekarang</div>
    <div class="card-action" onclick="mulaiAbsenTanggalLain()">üóìÔ∏è Absen Lain</div>
    <div class="card-action" onclick="mulaiGantikan()">üîÅ Gantikan</div>
  </div>
  
  <div class="grid">
    <div class="card-action" onclick="tampilkanRanking()">üèÜ Statistik Total</div>
    <div class="card-action" onclick="tampilkanLaporanBulanan()">üßæ Laporan Bulanan</div>
    <div class="card-action" onclick="tampilkanStatus()">üìã Status Jadwal</div>
    <div class="card-action" onclick="tampilkanPengaturan()">üé® Pengaturan Tema</div>
  </div>
  
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div class="section-title" onclick="mulaiFilterRiwayat()">Riwayat Absensi (<span id="filter-status">Semua Karyawan</span>)</div>
    <select id="sort-riwayat" onchange="tampilkan()" style="padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
        <option value="terbaru">Terbaru</option>
        <option value="terlama">Terlama</option>
        <option value="nama_asc">Nama (A-Z)</option>
    </select>
  </div>
  <div id="riwayat"></div>
</div>

<div id="overlay"></div>
<div id="toast"></div>

<script>
// Data absensi
let data = JSON.parse(localStorage.getItem("absensi") || "[]");
let karyawan = ["Lala", "Zaki", "Kemi", "Haris", "Izzul", "Fawaz"]; 
let mode = null;
let pengganti = null;
let filterAktif = "Semua Karyawan";

// Tema & Background
let savedTheme = localStorage.getItem("theme") || "default";
let savedBg = localStorage.getItem("backgroundImage") || null;

function applySavedTheme(){
  if(savedTheme==="gelap"){ document.body.style.background="#1c1c1e"; document.body.style.color="white"; }
  else if(savedTheme==="terang"){ document.body.style.background="#ffffff"; document.body.style.color="#000"; }
  else { document.body.style.background="var(--bg)"; document.body.style.color="var(--text)"; }
}
function applySavedBackground(){
  if(savedBg){
    document.body.style.backgroundImage=`url('${savedBg}')`;
    document.body.style.backgroundSize="cover";
    document.body.style.backgroundAttachment="fixed";
  }
}
applySavedTheme();
applySavedBackground();

// Utils
function todayDate(){ return new Date().toISOString().split('T')[0]; }
function showToast(message) {
    const toast = document.getElementById("toast");
    toast.innerHTML = message;
    toast.className = "show";
    setTimeout(()=>{ toast.className = toast.className.replace("show", ""); }, 3000);
}
function tutupOverlay(){ document.getElementById("overlay").style.display="none"; mode = null; pengganti = null; }

// Tampilan riwayat
function tampilkan(){
  let wrap = document.getElementById("riwayat");
  wrap.innerHTML = "";
  document.getElementById('filter-status').innerText = filterAktif;
  let dataTampil = [...data];
  dataTampil.forEach(d => {
    let div = document.createElement("div");
    div.className = `riwayat-item ${d.jenis.toLowerCase()}`;
    div.innerHTML = `<div><strong>${d.nama||d.pengganti} ${d.jenis}</strong><br><span>${d.tanggal} ${d.waktu}</span></div>`;
    wrap.appendChild(div);
  });
}

// Proses absen
function absen(nama, tanggal, waktu) {
    data.push({nama, waktu, tanggal, jenis: "Absen"});
    localStorage.setItem("absensi", JSON.stringify(data));
    showToast(`‚úÖ ${nama} berhasil Absen`);
    tampilkan();
}
function mulaiAbsen(){
    const waktuSekarang = new Date().toLocaleTimeString('id-ID', { hour12: false, hour: '2-digit', minute: '2-digit' });
    mode="absen";
    tampilOverlayPilih(karyawan,"üëã Pilih Karyawan yang Absen");
}
function mulaiAbsenTanggalLain() {
    mode = "absenLain";
    const hariIni = todayDate();
    const waktuSekarang = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
    let ov=document.getElementById("overlay");
    ov.innerHTML = `
        <h3>üóìÔ∏è Absen Tanggal & Waktu Lain</h3>
        <form id="absensi-form" onsubmit="event.preventDefault(); prosesAbsenLain()">
            <select id="karyawan-select">${karyawan.map(n => `<option value="${n}">${n}</option>`).join('')}</select>
            <input type="date" id="tgl-absen" value="${hariIni}">
            <input type="time" id="wkt-absen" value="${waktuSekarang}">
            <button type="submit">Absen</button>
        </form>
    `;
    let batal=document.createElement("div");
    batal.className="batal-btn-overlay"; batal.innerText="Batal"; batal.onclick=tutupOverlay;
    ov.appendChild(batal); ov.style.display="block";
}
function prosesAbsenLain() {
    const nama = document.getElementById('karyawan-select').value;
    const tanggal = document.getElementById('tgl-absen').value;
    const waktu = document.getElementById('wkt-absen').value;
    absen(nama, tanggal, waktu);
    tutupOverlay();
}
function tampilOverlayPilih(list,judul="Pilih Karyawan"){
  let ov=document.getElementById("overlay");
  ov.innerHTML=`<h3>${judul}</h3>`;
  list.forEach(n=>{
    let item=document.createElement("div");
    item.className="list-item";
    item.innerHTML = `<span>${n}</span>`;
    item.onclick=()=>{pilihNama(n);};
    ov.appendChild(item);
  });
  let batal=document.createElement("div");
  batal.className="batal-btn-overlay"; batal.innerText="Batal"; batal.onclick=tutupOverlay;
  ov.appendChild(batal); ov.style.display="block";
}
function pilihNama(nama){
  if(mode==="absen"){
    const waktuSekarang = new Date().toLocaleTimeString('id-ID', { hour12: false, hour: '2-digit', minute: '2-digit' });
    absen(nama, todayDate(), waktuSekarang);
  }
  tutupOverlay();
}

// ================= Pengaturan Tema ==================
function tampilkanPengaturan(){
  let ov=document.getElementById("overlay");
  ov.innerHTML=`
    <h3>üé® Pengaturan Tampilan</h3>
    <label>Pilih Tema:</label>
    <select id="tema-select" onchange="gantiTema()">
      <option value="default" ${savedTheme==="default"?"selected":""}>Default</option>
      <option value="gelap" ${savedTheme==="gelap"?"selected":""}>Gelap</option>
      <option value="terang" ${savedTheme==="terang"?"selected":""}>Terang</option>
    </select>
    <br><br>
    <label>Upload Foto Latar:</label>
    <input type="file" id="bg-upload" accept="image/*" onchange="gantiBackground(event)">
    <div class="batal-btn-overlay" onclick="tutupOverlay()">Tutup</div>
  `;
  ov.style.display="block";
}
function gantiTema(){
  let tema=document.getElementById("tema-select").value;
  savedTheme=tema;
  localStorage.setItem("theme",tema);
  applySavedTheme();
}
function gantiBackground(e){
  let file=e.target.files[0];
  if(file){
    let reader=new FileReader();
    reader.onload=function(ev){
      savedBg=ev.target.result;
      localStorage.setItem("backgroundImage",savedBg);
      applySavedBackground();
    };
    reader.readAsDataURL(file);
  }
}
document.addEventListener('DOMContentLoaded', tampilkan);
</script>
</body>
</html>